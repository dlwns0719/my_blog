<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Junhyun Lee</title>
<link>https://dlwns0719.github.io/my_blog/docs/blog/</link>
<atom:link href="https://dlwns0719.github.io/my_blog/docs/blog/index.xml" rel="self" type="application/rss+xml"/>
<description>blog</description>
<generator>quarto-1.8.25</generator>
<lastBuildDate>Fri, 31 Oct 2025 15:00:00 GMT</lastBuildDate>
<item>
  <title>RAG</title>
  <dc:creator>Junhyun Lee</dc:creator>
  <link>https://dlwns0719.github.io/my_blog/docs/blog/posts/RAG/</link>
  <description><![CDATA[ 






<section id="rag" class="level2" data-number="1">

<section id="agent" class="level3" data-number="1.1">

<ol type="1">
<li><a href="../../../../docs/blog/posts/RAG/15-Agent/01-Tools.html">01-Tools</a></li>
<li><a href="../../../../docs/blog/posts/RAG/15-Agent/02-Bind-Tools.html">02-Bind-Tools</a></li>
<li><a href="../../../../docs/blog/posts/RAG/15-Agent/03-Agent.html">03-Agent</a></li>
<li><a href="../../../../docs/blog/posts/RAG/15-Agent/04-Agent-More-LLMs.html">04-Agent-More-LLMs</a></li>
<li><a href="../../../../docs/blog/posts/RAG/15-Agent/05-Iter-Human-In-the-Loop.html">05-Iter-Human-In-the-Loop</a></li>
</ol>


</section>
</section>

 ]]></description>
  <category>AI</category>
  <category>LangChain</category>
  <category>RAG</category>
  <guid>https://dlwns0719.github.io/my_blog/docs/blog/posts/RAG/</guid>
  <pubDate>Fri, 31 Oct 2025 15:00:00 GMT</pubDate>
</item>
<item>
  <title>Prompt_Engineering</title>
  <dc:creator>Junhyun Lee</dc:creator>
  <link>https://dlwns0719.github.io/my_blog/docs/blog/posts/Prompt_Engineering/</link>
  <description><![CDATA[ 









 ]]></description>
  <category>AI</category>
  <category>LangChain</category>
  <category>RAG</category>
  <guid>https://dlwns0719.github.io/my_blog/docs/blog/posts/Prompt_Engineering/</guid>
  <pubDate>Fri, 31 Oct 2025 15:00:00 GMT</pubDate>
</item>
<item>
  <title>OpenAI 외 도구 호출 에이전트(Tool Calling Agent)</title>
  <link>https://dlwns0719.github.io/my_blog/docs/blog/posts/RAG/15-Agent/04-Agent-More-LLMs.html</link>
  <description><![CDATA[ 






<p>OpenAI 외에도 <code>Anthropic</code>, <code>Google Gemini</code>, <code>Together.ai</code>, <code>Ollama</code>, <code>Mistral</code>과 같은 더 광범위한 공급자 구현을 지원합니다.</p>
<p>이번 챕터에서는 다양한 LLM 을 사용하여 도구 호출 에이전트를 생성하고 실행하는 방법을 살펴보겠습니다.</p>
<p><strong>참고 링크</strong></p>
<ul>
<li><a href="https://python.langchain.com/v0.1/docs/modules/agents/agent_types/tool_calling/">LangChain 공식 도큐먼트</a></li>
</ul>
<div id="68e6b0d8" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># API 키를 환경변수로 관리하기 위한 설정 파일</span></span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dotenv <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> load_dotenv</span>
<span id="cb1-3"></span>
<span id="cb1-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># API 키 정보 로드</span></span>
<span id="cb1-5">load_dotenv()</span></code></pre></div></div>
</details>
</div>
<div id="d290ebe1" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># LangSmith 추적을 설정합니다. https://smith.langchain.com</span></span>
<span id="cb2-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># !pip install -qU langchain-teddynote</span></span>
<span id="cb2-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_teddynote <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> logging</span>
<span id="cb2-4"></span>
<span id="cb2-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 프로젝트 이름을 입력합니다.</span></span>
<span id="cb2-6">logging.langsmith(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CH15-Agents"</span>)</span></code></pre></div></div>
</details>
</div>
<div id="7c39877a" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain.tools <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> tool</span>
<span id="cb3-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> List, Dict</span>
<span id="cb3-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_teddynote.tools <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> GoogleNews</span>
<span id="cb3-4"></span>
<span id="cb3-5"></span>
<span id="cb3-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 도구 정의</span></span>
<span id="cb3-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@tool</span></span>
<span id="cb3-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> search_news(query: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> List[Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>]]:</span>
<span id="cb3-9">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Search Google News by input keyword"""</span></span>
<span id="cb3-10">    news_tool <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> GoogleNews()</span>
<span id="cb3-11">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> news_tool.search_by_keyword(query, k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb3-12"></span>
<span id="cb3-13"></span>
<span id="cb3-14"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"도구 이름: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>search_news<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb3-15"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"도구 설명: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>search_news<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>description<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div></div>
</details>
</div>
<div id="8aa5a8e1" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># tools 정의</span></span>
<span id="cb4-2">tools <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [search_news]</span></code></pre></div></div>
</details>
</div>
<section id="agent-용-프롬프트-생성" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="agent-용-프롬프트-생성"><span class="header-section-number">1</span> Agent 용 프롬프트 생성</h2>
<ul>
<li><code>chat_history</code> : 이전 대화 내용을 저장하는 변수 (멀티턴을 지원하지 않는다면, 생략 가능합니다.)</li>
<li><code>agent_scratchpad</code> : 에이전트가 임시로 저장하는 변수</li>
<li><code>input</code> : 사용자의 입력</li>
</ul>
<div id="996cbf84" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.prompts <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ChatPromptTemplate</span>
<span id="cb5-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain.agents <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> create_tool_calling_agent</span>
<span id="cb5-3"></span>
<span id="cb5-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 프롬프트 생성</span></span>
<span id="cb5-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 프롬프트는 에이전트에게 모델이 수행할 작업을 설명하는 텍스트를 제공합니다. (도구의 이름과 역할을 입력)</span></span>
<span id="cb5-6">prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ChatPromptTemplate.from_messages(</span>
<span id="cb5-7">    [</span>
<span id="cb5-8">        (</span>
<span id="cb5-9">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"system"</span>,</span>
<span id="cb5-10">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"You are a helpful assistant. "</span></span>
<span id="cb5-11">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Make sure to use the `search_news` tool for searching keyword related news."</span>,</span>
<span id="cb5-12">        ),</span>
<span id="cb5-13">        (<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"placeholder"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{chat_history}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>),</span>
<span id="cb5-14">        (<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"human"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{input}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>),</span>
<span id="cb5-15">        (<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"placeholder"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{agent_scratchpad}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>),</span>
<span id="cb5-16">    ]</span>
<span id="cb5-17">)</span></code></pre></div></div>
</details>
</div>
</section>
<section id="tool-calling-을-지원하는-다양한-llm-목록" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="tool-calling-을-지원하는-다양한-llm-목록"><span class="header-section-number">2</span> Tool Calling 을 지원하는 다양한 LLM 목록</h2>
<p>실습 진행을 위해서는 아래 내용을 설정해야 합니다.</p>
<p><strong>Anthropic</strong></p>
<ul>
<li><a href="https://console.anthropic.com/settings/keys">Anthropic API 키 발급 관련</a></li>
<li><code>.env</code> 파일 내 <code>ANTHROPIC_API_KEY</code> 에 발급받은 키를 설정하세요</li>
</ul>
<p><strong>Gemini</strong></p>
<ul>
<li><a href="https://aistudio.google.com/app/apikey?hl=ko">Gemini API 키 발급 관련</a></li>
<li><code>.env</code> 파일 내 <code>GOOGLE_API_KEY</code> 에 발급받은 키를 설정하세요</li>
</ul>
<p><strong>Together AI</strong></p>
<ul>
<li><a href="https://api.together.ai/">Together AI API 키 발급 관련</a></li>
<li><code>.env</code> 파일 내 <code>TOGETHER_API_KEY</code> 에 발급받은 키를 설정하세요</li>
</ul>
<p><strong>Ollama</strong></p>
<ul>
<li><a href="https://ollama.com/search?c=tools">Ollama Tool Calling 지원 모델 리스트</a></li>
<li><a href="https://ollama.com/library/llama3.1">이번 실습에 사용할 llama3.1 모델</a></li>
<li>터미널 창에 <code>ollama pull llama3.1</code> 명령어를 입력하여 모델을 다운로드 받습니다.</li>
<li>이전에 Ollama 를 사용하지 않았다면, <a href="https://wikidocs.net/233805">Ollama</a> 를 참고해 주세요.</li>
</ul>
<p>langchain-ollama 설치를 한 뒤 진행해 주세요.</p>
<div id="b4a4279f" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># !pip install -qU langchain-ollama==0.1.3</span></span></code></pre></div></div>
</details>
</div>
<div id="b0dd3013" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_anthropic <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ChatAnthropic</span>
<span id="cb7-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_google_genai <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ChatGoogleGenerativeAI</span>
<span id="cb7-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_openai <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ChatOpenAI</span>
<span id="cb7-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_ollama <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ChatOllama</span>
<span id="cb7-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb7-6"></span>
<span id="cb7-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># GPT-4o-mini</span></span>
<span id="cb7-8">gpt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ChatOpenAI(model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gpt-4o-mini"</span>)</span>
<span id="cb7-9"></span>
<span id="cb7-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Claude-3-5-sonnet</span></span>
<span id="cb7-11">claude <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ChatAnthropic(model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"claude-3-5-sonnet-20240620"</span>, temperature<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb7-12"></span>
<span id="cb7-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Gemini-1.5-pro-latest</span></span>
<span id="cb7-14">gemini <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ChatGoogleGenerativeAI(model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gemini-1.5-pro"</span>, temperature<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb7-15"></span>
<span id="cb7-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Llama-3.1-70B-Instruct-Turbo</span></span>
<span id="cb7-17">llama <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ChatOpenAI(</span>
<span id="cb7-18">    base_url<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://api.together.xyz/v1"</span>,</span>
<span id="cb7-19">    api_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>os.environ[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TOGETHER_API_KEY"</span>],</span>
<span id="cb7-20">    model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"meta-llama/Meta-Llama-3.1-70B-Instruct-Turbo"</span>,</span>
<span id="cb7-21">)</span>
<span id="cb7-22"></span>
<span id="cb7-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Llama-3.1</span></span>
<span id="cb7-24">ollama <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ChatOllama(model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"llama3.1"</span>, temperature<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb7-25"></span>
<span id="cb7-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Qwen2.5 7B (한글 성능 괜찮은 편)</span></span>
<span id="cb7-27">qwen <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ChatOllama(</span>
<span id="cb7-28">    model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"qwen2.5:latest"</span>,</span>
<span id="cb7-29">)</span></code></pre></div></div>
</details>
</div>
<p>LLM 기반으로 Agent 를 생성합니다.</p>
<div id="7c27396e" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain.agents <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> create_tool_calling_agent</span>
<span id="cb8-2"></span>
<span id="cb8-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Agent 생성</span></span>
<span id="cb8-4">gpt_agent <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> create_tool_calling_agent(gpt, tools, prompt)</span>
<span id="cb8-5">claude_agent <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> create_tool_calling_agent(claude, tools, prompt)</span>
<span id="cb8-6">gemini_agent <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> create_tool_calling_agent(gemini, tools, prompt)</span>
<span id="cb8-7">llama_agent <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> create_tool_calling_agent(llama, tools, prompt)</span>
<span id="cb8-8">ollama_agent <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> create_tool_calling_agent(ollama, tools, prompt)</span>
<span id="cb8-9">qwen_agent <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> create_tool_calling_agent(qwen, tools, prompt)</span></code></pre></div></div>
</details>
</div>
</section>
<section id="agentexecutor-생성-후-실행-및-결과-확인" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="agentexecutor-생성-후-실행-및-결과-확인"><span class="header-section-number">3</span> AgentExecutor 생성 후 실행 및 결과 확인</h2>
<div id="e93f25bc" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain.agents <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> AgentExecutor</span>
<span id="cb9-2"></span>
<span id="cb9-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># gpt_agent 실행</span></span>
<span id="cb9-4">agent_executor <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AgentExecutor(</span>
<span id="cb9-5">    agent<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>gpt_agent,</span>
<span id="cb9-6">    tools<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>tools,</span>
<span id="cb9-7">    verbose<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>,</span>
<span id="cb9-8">    handle_parsing_errors<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>,</span>
<span id="cb9-9">)</span>
<span id="cb9-10"></span>
<span id="cb9-11">result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> agent_executor.invoke({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"input"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AI 투자와 관련된 뉴스를 검색해 주세요."</span>})</span>
<span id="cb9-12"></span>
<span id="cb9-13"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Agent 실행 결과:"</span>)</span>
<span id="cb9-14"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"output"</span>])</span></code></pre></div></div>
</details>
</div>
<p>다양한 llm을 사용하여 에이전트를 실행합니다.</p>
<p>다음은 입력받은 llm을 사용하여 Agent 를 생성하고 실행하여 결과를 출력하는 함수입니다.</p>
<div id="b94c7736" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> execute_agent(llm, tools, input_text, label):</span>
<span id="cb10-2">    agent <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> create_tool_calling_agent(llm, tools, prompt)</span>
<span id="cb10-3">    executor <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AgentExecutor(agent<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>agent, tools<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>tools, verbose<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb10-4">    result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> executor.invoke({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"input"</span>: input_text})</span>
<span id="cb10-5">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"[</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>label<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">] 결과입니다."</span>)</span>
<span id="cb10-6">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">isinstance</span>(result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"output"</span>], <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">and</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"output"</span>]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>:</span>
<span id="cb10-7">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> item <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"output"</span>]:</span>
<span id="cb10-8">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> item:</span>
<span id="cb10-9">                <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(item[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"text"</span>])</span>
<span id="cb10-10">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">elif</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">isinstance</span>(result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"output"</span>], <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>):</span>
<span id="cb10-11">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"output"</span>])</span>
<span id="cb10-12">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb10-13">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"output"</span>])</span></code></pre></div></div>
</details>
</div>
<p>각 llm 별로 에이전트를 생성하고 실행하여 결과를 출력합니다.</p>
<div id="64854b4e" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1">query <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb11-2">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AI 투자와 관련된 뉴스를 검색하고, 결과를 Instagram 게시글 형식으로 작성해 주세요."</span></span>
<span id="cb11-3">)</span></code></pre></div></div>
</details>
</div>
<div id="883ecb50" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># gpt</span></span>
<span id="cb12-2">execute_agent(gpt, tools, query, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gpt"</span>)</span></code></pre></div></div>
</details>
</div>
<div id="adbbd88e" class="cell" data-execution_count="13">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># claude</span></span>
<span id="cb13-2">execute_agent(claude, tools, query, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"claude"</span>)</span></code></pre></div></div>
</details>
</div>
<div id="32995ef4" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># gemini</span></span>
<span id="cb14-2">execute_agent(gemini, tools, query, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gemini"</span>)</span></code></pre></div></div>
</details>
</div>
<div id="90ea433a" class="cell" data-execution_count="15">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># llama3.1 70B (Together.ai)</span></span>
<span id="cb15-2">execute_agent(</span>
<span id="cb15-3">    llama,</span>
<span id="cb15-4">    tools,</span>
<span id="cb15-5">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Search AI related news and write it in Instagram post format"</span>,</span>
<span id="cb15-6">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"llama3.1 70B"</span>,</span>
<span id="cb15-7">)</span></code></pre></div></div>
</details>
</div>
<div id="f06d1a42" class="cell" data-execution_count="16">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># llama3.1 8B (ollama)</span></span>
<span id="cb16-2">execute_agent(ollama, tools, query, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"llama3.1(Ollama)"</span>)</span></code></pre></div></div>
</details>
</div>
<div id="e0d6d129" class="cell" data-execution_count="17">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># qwen2.5 7B (ollama)</span></span>
<span id="cb17-2">query <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AI 투자와 관련된 뉴스를 검색하고, 결과를 Instagram 게시글 형식으로 작성해 주세요. 한글로 답변하세요!"</span></span>
<span id="cb17-3"></span>
<span id="cb17-4">execute_agent(qwen, tools, query, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"qwen2.5(Ollama)"</span>)</span></code></pre></div></div>
</details>
</div>


</section>

 ]]></description>
  <guid>https://dlwns0719.github.io/my_blog/docs/blog/posts/RAG/15-Agent/04-Agent-More-LLMs.html</guid>
  <pubDate>Thu, 20 Nov 2025 00:36:30 GMT</pubDate>
</item>
<item>
  <title>도구 (Tools)</title>
  <link>https://dlwns0719.github.io/my_blog/docs/blog/posts/RAG/15-Agent/01-Tools.html</link>
  <description><![CDATA[ 






<p>도구(Tool)는 에이전트, 체인 또는 LLM이 외부 세계와 상호작용하기 위한 인터페이스입니다.</p>
<p>LangChain 에서 기본 제공하는 도구를 사용하여 쉽게 도구를 활용할 수 있으며, 사용자 정의 도구(Custom Tool) 를 쉽게 구축하는 것도 가능합니다.</p>
<p><strong>LangChain 에 통합된 도구 리스트는 아래 링크에서 확인할 수 있습니다.</strong></p>
<ul>
<li><a href="https://python.langchain.com/v0.1/docs/integrations/tools/">LangChain 통합된 도구 리스트</a></li>
</ul>
<div id="162928bb" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># API 키를 환경변수로 관리하기 위한 설정 파일</span></span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dotenv <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> load_dotenv</span>
<span id="cb1-3"></span>
<span id="cb1-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># API 키 정보 로드</span></span>
<span id="cb1-5">load_dotenv()</span></code></pre></div></div>
</details>
</div>
<div id="adba0a4e" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># LangSmith 추적을 설정합니다. https://smith.langchain.com</span></span>
<span id="cb2-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># !pip install -qU langchain-teddynote</span></span>
<span id="cb2-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_teddynote <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> logging</span>
<span id="cb2-4"></span>
<span id="cb2-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 프로젝트 이름을 입력합니다.</span></span>
<span id="cb2-6">logging.langsmith(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CH15-Tools"</span>)</span></code></pre></div></div>
</details>
</div>
<div id="73f66311" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> warnings</span>
<span id="cb3-2"></span>
<span id="cb3-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 경고 메시지 무시</span></span>
<span id="cb3-4">warnings.filterwarnings(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ignore"</span>)</span></code></pre></div></div>
</details>
</div>
<section id="빌트인-도구built-in-tools" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="빌트인-도구built-in-tools"><span class="header-section-number">1</span> 빌트인 도구(built-in tools)</h2>
<p>랭체인에서 제공하는 사전에 정의된 도구(tool) 와 툴킷(toolkit) 을 사용할 수 있습니다.</p>
<p>tool 은 단일 도구를 의미하며, toolkit 은 여러 도구를 묶어서 하나의 도구로 사용할 수 있습니다.</p>
<p>관련 도구는 아래의 링크에서 참고하실 수 있습니다.</p>
<p><strong>참고</strong> - <a href="https://python.langchain.com/docs/integrations/tools/">LangChain Tools/Toolkits</a></p>
<section id="python-repl-도구" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="python-repl-도구"><span class="header-section-number">1.1</span> Python REPL 도구</h3>
<p>이 도구는 Python 코드를 REPL(Read-Eval-Print Loop) 환경에서 실행하기 위한 클래스를 제공합니다 어떤 코드를 만들어서 실행하는 것이다. - PythonREPLTool</p>
<p><strong>설명</strong></p>
<ul>
<li>Python 셸 환경을 제공합니다.</li>
<li>유효한 Python 명령어를 입력으로 받아 실행합니다.</li>
<li>결과를 보려면 print(…) 함수를 사용해야 합니다.</li>
</ul>
<p><strong>주요 특징</strong></p>
<ul>
<li>sanitize_input: 입력을 정제하는 옵션 (기본값: True)</li>
<li>python_repl: PythonREPL 인스턴스 (기본값: 전역 범위에서 실행)</li>
</ul>
<p><strong>사용 방법</strong></p>
<ul>
<li>PythonREPLTool 인스턴스 생성</li>
<li>run 또는 arun, invoke 메서드를 사용하여 Python 코드 실행</li>
</ul>
<p><strong>입력 정제</strong></p>
<ul>
<li>입력 문자열에서 불필요한 공백, 백틱, ‘python’ 키워드 등을 제거합니다.</li>
</ul>
<div id="d943ee9e" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_experimental.tools <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> PythonREPLTool</span>
<span id="cb4-2"></span>
<span id="cb4-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 파이썬 코드를 실행하는 도구를 생성합니다.</span></span>
<span id="cb4-4">python_tool <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> PythonREPLTool()</span></code></pre></div></div>
</details>
</div>
<div id="5c92c03c" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 파이썬 코드를 실행하고 결과를 반환합니다.</span></span>
<span id="cb5-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(python_tool.invoke(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"print(100 + 200)"</span>))</span></code></pre></div></div>
</details>
</div>
<p>아래는 LLM 에게 파이썬 코드를 작성하도록 요청하고 결과를 반환하는 예제입니다.</p>
<p><strong>흐름 정리</strong> 1. LLM 모델에게 특정 작업을 수행하는 Python 코드를 작성하도록 요청합니다. 2. 작성된 코드를 실행하여 결과를 얻습니다. 3. 결과를 출력합니다.</p>
<div id="544403e4" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_openai <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ChatOpenAI</span>
<span id="cb6-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.prompts <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ChatPromptTemplate</span>
<span id="cb6-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.output_parsers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> StrOutputParser</span>
<span id="cb6-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.runnables <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> RunnableLambda</span>
<span id="cb6-5"></span>
<span id="cb6-6"></span>
<span id="cb6-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 파이썬 코드를 실행하고 중간 과정을 출력하고 도구 실행 결과를 반환하는 함수</span></span>
<span id="cb6-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> print_and_execute(code, debug<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>):</span>
<span id="cb6-9">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> debug:</span>
<span id="cb6-10">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CODE:"</span>)</span>
<span id="cb6-11">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(code)</span>
<span id="cb6-12">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> python_tool.invoke(code)</span>
<span id="cb6-13"></span>
<span id="cb6-14"></span>
<span id="cb6-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 파이썬 코드를 작성하도록 요청하는 프롬프트</span></span>
<span id="cb6-16">prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ChatPromptTemplate.from_messages(</span>
<span id="cb6-17">    [</span>
<span id="cb6-18">        (</span>
<span id="cb6-19">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"system"</span>,</span>
<span id="cb6-20">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"You are Raymond Hetting, an expert python programmer, well versed in meta-programming and elegant, concise and short but well documented code. You follow the PEP8 style guide. "</span></span>
<span id="cb6-21">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Return only the code, no intro, no explanation, no chatty, no markdown, no code block, no nothing. Just the code."</span>,</span>
<span id="cb6-22">        ),</span>
<span id="cb6-23">        (<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"human"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{input}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>),</span>
<span id="cb6-24">    ]</span>
<span id="cb6-25">)</span>
<span id="cb6-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># LLM 모델 생성</span></span>
<span id="cb6-27">llm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ChatOpenAI(model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gpt-4o"</span>, temperature<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb6-28"></span>
<span id="cb6-29"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 프롬프트와 LLM 모델을 사용하여 체인 생성</span></span>
<span id="cb6-30">chain <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> llm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> StrOutputParser() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> RunnableLambda(print_and_execute)</span></code></pre></div></div>
</details>
</div>
<div id="407d9735" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 결과 출력</span></span>
<span id="cb7-2"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(chain.invoke(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"로또 번호 생성기를 출력하는 코드를 작성하세요."</span>))</span></code></pre></div></div>
</details>
</div>
</section>
<section id="검색-api-도구" class="level3" data-number="1.2">
<h3 data-number="1.2" class="anchored" data-anchor-id="검색-api-도구"><span class="header-section-number">1.2</span> 검색 API 도구</h3>
<p>Tavily 검색 API를 활용하여 검색 기능을 구현하는 도구입니다. 이 도구는 두 가지 주요 클래스를 제공합니다: <code>TavilySearchResults</code>와 <code>TavilyAnswer</code>.</p>
<p><strong>API 키 발급 주소</strong> - https://app.tavily.com/</p>
<p>발급한 API 키를 환경변수에 설정합니다.</p>
<p><code>.env</code> 파일에 아래와 같이 설정합니다.</p>
<pre><code>TAVILY_API_KEY=tvly-abcdefghijklmnopqrstuvwxyz</code></pre>
</section>
<section id="tavilysearchresults" class="level3" data-number="1.3">
<h3 data-number="1.3" class="anchored" data-anchor-id="tavilysearchresults"><span class="header-section-number">1.3</span> TavilySearchResults</h3>
<p><strong>설명</strong> - Tavily 검색 API를 쿼리하고 JSON 형식의 결과를 반환합니다. - 포괄적이고 정확하며 신뢰할 수 있는 결과에 최적화된 검색 엔진입니다. - 현재 이벤트에 대한 질문에 답변할 때 유용합니다. - 사용자가 LLM/RAG 에서도 없는 최신 정보가 불만족스럽거나, 그럴때 사용하는것.</p>
<p><strong>주요 매개변수</strong> - <code>max_results</code> (int): 반환할 최대 검색 결과 수 (기본값: 5) - <code>search_depth</code> (str): 검색 깊이 (“basic” 또는 “advanced”) - <code>include_domains</code> (List[str]): 검색 결과에 포함할 도메인 목록 - <code>exclude_domains</code> (List[str]): 검색 결과에서 제외할 도메인 목록 - <code>include_answer</code> (bool): 원본 쿼리에 대한 짧은 답변 포함 여부 - <code>include_raw_content</code> (bool): 각 사이트의 정제된 HTML 콘텐츠 포함 여부 - <code>include_images</code> (bool): 쿼리 관련 이미지 목록 포함 여부</p>
<p><strong>반환 값</strong> - 검색 결과를 포함하는 JSON 형식의 문자열(url, content)</p>
<p>혹은 아래의 주석을 해제하고 발급받은 API 키를 입력합니다.</p>
<div id="2bb4df80" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># import os</span></span>
<span id="cb9-2"></span>
<span id="cb9-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># os.environ["TAVILY_API_KEY"] = "TAVILY API 키 입력"</span></span></code></pre></div></div>
</details>
</div>
<div id="7d2ec10b" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_community.tools.tavily_search <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> TavilySearchResults</span>
<span id="cb10-2"></span>
<span id="cb10-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 도구 생성</span></span>
<span id="cb10-4">tool <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> TavilySearchResults(</span>
<span id="cb10-5">    max_results<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>,</span>
<span id="cb10-6">    include_answer<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>,</span>
<span id="cb10-7">    include_raw_content<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>,</span>
<span id="cb10-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># include_images=True,</span></span>
<span id="cb10-9">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># search_depth="advanced", # or "basic"</span></span>
<span id="cb10-10">    include_domains<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"github.io"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wikidocs.net"</span>],</span>
<span id="cb10-11">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># exclude_domains = []</span></span>
<span id="cb10-12">)</span></code></pre></div></div>
</details>
</div>
<div id="a640a496" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 도구 실행</span></span>
<span id="cb11-2">tool.invoke({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"query"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"LangChain Tools 에 대해서 알려주세요"</span>})</span></code></pre></div></div>
</details>
</div>
</section>
<section id="image-생성-도구-dall-e" class="level3" data-number="1.4">
<h3 data-number="1.4" class="anchored" data-anchor-id="image-생성-도구-dall-e"><span class="header-section-number">1.4</span> Image 생성 도구 (DALL-E)</h3>
<ul>
<li><code>DallEAPIWrapper 클래스</code>: OpenAI의 DALL-E 이미지 생성기를 위한 래퍼(wrapper)입니다.</li>
</ul>
<p>이 도구를 사용하면 DALL-E API를 쉽게 통합하여 텍스트 기반 이미지 생성 기능을 구현할 수 있습니다. 다양한 설정 옵션을 통해 유연하고 강력한 이미지 생성 도구로 활용할 수 있습니다.</p>
<p><strong>주요 속성</strong></p>
<ul>
<li><p><code>model</code>: 사용할 DALL-E 모델 이름 (기본값: “dall-e-2”, “dall-e-3”)</p></li>
<li><p><code>n</code>: 생성할 이미지 수 (기본값: 1)</p></li>
<li><p><code>size</code>: 생성할 이미지 크기</p>
<ul>
<li>“dall-e-2”: “1024x1024”, “512x512”, “256x256”</li>
<li>“dall-e-3”: “1024x1024”, “1792x1024”, “1024x1792”</li>
</ul></li>
<li><p><code>style</code>: 생성될 이미지의 스타일 (기본값: “natural”, “vivid”)</p></li>
<li><p><code>quality</code>: 생성될 이미지의 품질 (기본값: “standard”, “hd”)</p></li>
<li><p><code>max_retries</code>: 생성 시 최대 재시도 횟수</p></li>
</ul>
<p><strong>주요 기능</strong> - DALL-E API를 사용하여 텍스트 설명에 기반한 이미지 생성</p>
<p><strong>흐름 정리</strong></p>
<p>다음은 DALL-E Image Generator 를 사용하여 이미지를 생성하는 예제입니다.</p>
<p>이번에는 <code>DallEAPIWrapper</code> 를 사용하여 이미지를 생성해 보겠습니다.</p>
<p>이때 입력 프롬프트는 LLM 모델에게 이미지를 생성하는 프롬프트를 작성하도록 요청합니다.</p>
<div id="ce07ac5e" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.output_parsers <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> StrOutputParser</span>
<span id="cb12-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.prompts <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> PromptTemplate</span>
<span id="cb12-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_openai <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ChatOpenAI</span>
<span id="cb12-4"></span>
<span id="cb12-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ChatOpenAI 모델 초기화</span></span>
<span id="cb12-6">llm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ChatOpenAI(model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gpt-4o-mini"</span>, temperature<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>, max_tokens<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>)</span>
<span id="cb12-7"></span>
<span id="cb12-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># DALL-E 이미지 생성을 위한 프롬프트 템플릿 정의</span></span>
<span id="cb12-9">prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> PromptTemplate.from_template(</span>
<span id="cb12-10">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Generate a detailed IMAGE GENERATION prompt for DALL-E based on the following description. "</span></span>
<span id="cb12-11">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Return only the prompt, no intro, no explanation, no chatty, no markdown, no code block, no nothing. Just the prompt"</span></span>
<span id="cb12-12">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Output should be less than 1000 characters. Write in English only."</span></span>
<span id="cb12-13">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Image Description: </span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{image_desc}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>,</span>
<span id="cb12-14">)</span>
<span id="cb12-15"></span>
<span id="cb12-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 프롬프트, LLM, 출력 파서를 연결하는 체인 생성</span></span>
<span id="cb12-17">chain <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> llm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> StrOutputParser()</span>
<span id="cb12-18"></span>
<span id="cb12-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 체인 실행</span></span>
<span id="cb12-20">image_prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> chain.invoke(</span>
<span id="cb12-21">    {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"image_desc"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"스마트폰을 바라보는 사람들을 풍자한 neo-classicism painting"</span>}</span>
<span id="cb12-22">)</span>
<span id="cb12-23"></span>
<span id="cb12-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 이미지 프롬프트 출력</span></span>
<span id="cb12-25"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(image_prompt)</span></code></pre></div></div>
</details>
</div>
<p>그럼, 이전에 생성한 이미지 프롬프트를 <code>DallEAPIWrapper</code> 에 입력하여 이미지를 생성해 보겠습니다.</p>
<p><strong><code>DallEAPIWrapper</code> 에 대한 임시 버그 안내사항</strong> (작성일: 2024-10-13)</p>
<ul>
<li>현재 langchain 0.3.x 이상 버전에서 <code>DallEAPIWrapper</code> 에 대한 임시 버그가 있습니다. (<code>401 오류: invalid API key</code>)</li>
</ul>
<p>따라서, 아래의 코드를 오류 없이 실행하기 위해서는 LangChain 버전을 0.2.16 으로 변경해야 합니다.</p>
<p>아래의 주석을 해제하고 실행하면 LangChain 버전을 0.2.16 으로 변경됩니다.</p>
<p>하지만, 이후 내용에서는 LangChain 버전을 0.3.x 이상으로 변경하여 사용하기 때문에</p>
<p><code>poetry shell</code> 명령어를 통해 다시 최신 langchain 버전으로 변경해야 합니다.</p>
<p>이 과정이 번거로운 분들은 일단 <code>DallEAPIWrapper</code> 를 사용하지 않고 진행하셔도 무방합니다.</p>
<p><strong>업그레이드/다운그레이드</strong> 후에는 반드시 상단 메뉴의 “Restart” 버튼을 클릭한 뒤 진행해야 합니다.</p>
<div id="b2aaca2d" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 임시 버전 다운그레이드 명령어 (실행 후 restart)</span></span>
<span id="cb13-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># !pip install langchain==0.2.16 langchain-community==0.2.16 langchain-text-splitters==0.2.4 langchain-experimental==0.0.65 langchain-openai==0.1.20</span></span></code></pre></div></div>
</details>
</div>
<div id="669cbaae" class="cell" data-execution_count="13">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># DALL-E API 래퍼 가져오기</span></span>
<span id="cb14-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_community.utilities.dalle_image_generator <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> DallEAPIWrapper</span>
<span id="cb14-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> IPython.display <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Image</span>
<span id="cb14-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> os</span>
<span id="cb14-5"></span>
<span id="cb14-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># DALL-E API 래퍼 초기화</span></span>
<span id="cb14-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># model: 사용할 DALL-E 모델 버전</span></span>
<span id="cb14-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># size: 생성할 이미지 크기</span></span>
<span id="cb14-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># quality: 이미지 품질</span></span>
<span id="cb14-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># n: 생성할 이미지 수</span></span>
<span id="cb14-11">dalle <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> DallEAPIWrapper(</span>
<span id="cb14-12">    model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dall-e-3"</span>,</span>
<span id="cb14-13">    size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"1024x1024"</span>,</span>
<span id="cb14-14">    quality<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"standard"</span>,</span>
<span id="cb14-15">    n<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb14-16">)</span>
<span id="cb14-17"></span>
<span id="cb14-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 질문</span></span>
<span id="cb14-19">query <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"스마트폰을 바라보는 사람들을 풍자한 neo-classicism painting"</span></span>
<span id="cb14-20"></span>
<span id="cb14-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 이미지 생성 및 URL 받기</span></span>
<span id="cb14-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># chain.invoke()를 사용하여 이미지 설명을 DALL-E 프롬프트로 변환</span></span>
<span id="cb14-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># dalle.run()을 사용하여 실제 이미지 생성</span></span>
<span id="cb14-24">image_url <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> dalle.run(chain.invoke({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"image_desc"</span>: query}))</span>
<span id="cb14-25"></span>
<span id="cb14-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 생성된 이미지를 표시합니다.</span></span>
<span id="cb14-27">Image(url<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>image_url, width<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span>)</span></code></pre></div></div>
</details>
</div>
</section>
</section>
<section id="사용자-정의-도구custom-tool" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="사용자-정의-도구custom-tool"><span class="header-section-number">2</span> 사용자 정의 도구(Custom Tool)</h2>
<p>LangChain 에서 제공하는 빌트인 도구 외에도 사용자가 직접 도구를 정의하여 사용할 수 있습니다.</p>
<p>이를 위해서는 <code>langchain.tools</code> 모듈에서 제공하는 <code>tool</code> 데코레이터를 사용하여 함수를 도구로 변환합니다.</p>
<section id="tool-데코레이터" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="tool-데코레이터"><span class="header-section-number">2.1</span> <span class="citation" data-cites="tool">@tool</span> 데코레이터</h3>
<p>이 데코레이터는 함수를 도구로 변환하는 기능을 제공합니다. 다양한 옵션을 통해 도구의 동작을 커스터마이즈할 수 있습니다.</p>
<p><strong>사용 방법</strong> 1. 함수 위에 <code>@tool</code> 데코레이터 적용 2. 필요에 따라 데코레이터 매개변수 설정</p>
<p>이 데코레이터를 사용하면 일반 Python 함수를 강력한 도구로 쉽게 변환할 수 있으며, 자동화된 문서화와 유연한 인터페이스 생성이 가능합니다.</p>
<div id="bb173b35" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain.tools <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> tool</span>
<span id="cb15-2"></span>
<span id="cb15-3"></span>
<span id="cb15-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 데코레이터를 사용하여 함수를 도구로 변환합니다.</span></span>
<span id="cb15-5"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@tool</span></span>
<span id="cb15-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> add_numbers(a: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>, b: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>:</span>
<span id="cb15-7">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Add two numbers"""</span></span>
<span id="cb15-8">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> a <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> b</span>
<span id="cb15-9"></span>
<span id="cb15-10"></span>
<span id="cb15-11"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@tool</span></span>
<span id="cb15-12"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> multiply_numbers(a: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>, b: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>:</span>
<span id="cb15-13">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Multiply two numbers"""</span></span>
<span id="cb15-14">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> a <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> b</span></code></pre></div></div>
</details>
</div>
<div id="58c9189a" class="cell" data-execution_count="15">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 도구 실행</span></span>
<span id="cb16-2">add_numbers.invoke({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a"</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"b"</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>})</span></code></pre></div></div>
</details>
</div>
<div id="dd962b45" class="cell" data-execution_count="16">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 도구 실행</span></span>
<span id="cb17-2">multiply_numbers.invoke({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a"</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"b"</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>})</span></code></pre></div></div>
</details>
</div>
</section>
<section id="구글-뉴스기사-검색-도구" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="구글-뉴스기사-검색-도구"><span class="header-section-number">2.2</span> 구글 뉴스기사 검색 도구</h3>
<p><code>langchain-teddynote</code> 패키지에서 제공하는 <code>GoogleNews</code> 도구를 사용하여 구글 뉴스기사를 검색하는 도구입니다.</p>
<p><strong>참고</strong> - API 키가 필요하지 않습니다. (RSS 피드를 사용하기 때문)</p>
<p>news.google.com 에서 제공하는 뉴스기사를 검색하는 도구입니다.</p>
<p><strong>설명</strong> - 구글 뉴스 검색 API를 사용하여 최신 뉴스를 검색합니다. - 키워드를 기반으로 뉴스를 검색할 수 있습니다. - 최신 뉴스를 검색할 수 있습니다.</p>
<p><strong>주요 매개변수</strong> - <code>k</code> (int): 반환할 최대 검색 결과 수 (기본값: 5)</p>
<p>사용하기 전 패키지를 업데이트 해주세요.</p>
<div id="d1d36cd5" class="cell" data-execution_count="17">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># !pip install -qU langchain-teddynote</span></span></code></pre></div></div>
</details>
</div>
<div id="91d4596c" class="cell" data-execution_count="18">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_teddynote.tools <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> GoogleNews</span>
<span id="cb19-2"></span>
<span id="cb19-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 도구 생성</span></span>
<span id="cb19-4">news_tool <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> GoogleNews()</span></code></pre></div></div>
</details>
</div>
<div id="28908a00" class="cell" data-execution_count="19">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 최신 뉴스 검색</span></span>
<span id="cb20-2">news_tool.search_latest(k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span></code></pre></div></div>
</details>
</div>
<div id="38f973dd" class="cell" data-execution_count="20">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 키워드로 뉴스 검색</span></span>
<span id="cb21-2">news_tool.search_by_keyword(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AI 투자"</span>, k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span></code></pre></div></div>
</details>
</div>
<div id="5b5c4a92" class="cell" data-execution_count="21">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_teddynote.tools <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> GoogleNews</span>
<span id="cb22-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain.tools <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> tool</span>
<span id="cb22-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> List, Dict</span>
<span id="cb22-4"></span>
<span id="cb22-5"></span>
<span id="cb22-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 키워드로 뉴스 검색하는 도구 생성</span></span>
<span id="cb22-7"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@tool</span></span>
<span id="cb22-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> search_keyword(query: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> List[Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>]]:</span>
<span id="cb22-9">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Look up news by keyword"""</span></span>
<span id="cb22-10">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(query)</span>
<span id="cb22-11">    news_tool <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> GoogleNews()</span>
<span id="cb22-12">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> news_tool.search_by_keyword(query, k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span></code></pre></div></div>
</details>
</div>
<div id="5db5b311" class="cell" data-execution_count="22">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 실행 결과</span></span>
<span id="cb23-2">search_keyword.invoke({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"query"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"LangChain AI"</span>})</span></code></pre></div></div>
</details>
</div>


</section>
</section>

 ]]></description>
  <guid>https://dlwns0719.github.io/my_blog/docs/blog/posts/RAG/15-Agent/01-Tools.html</guid>
  <pubDate>Thu, 20 Nov 2025 00:36:30 GMT</pubDate>
</item>
<item>
  <title>Iteration 기능과 사람 개입(Human-in-the-loop)</title>
  <link>https://dlwns0719.github.io/my_blog/docs/blog/posts/RAG/15-Agent/05-Iter-Human-In-the-Loop.html</link>
  <description><![CDATA[ 






<p><code>iter()</code> 메서드는 에이전트의 실행 과정을 단계별로 반복할 수 있게 해주는 반복자(iterator)를 생성합니다.</p>
<p>중간 과정에서 사용자의 입력을 받아 계속 진행할지 묻는 기능을 제공합니다. 이를 <code>Human-in-the-loop</code> 라고 합니다.</p>
<div id="2bc8a97c" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># API KEY를 환경변수로 관리하기 위한 설정 파일</span></span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dotenv <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> load_dotenv</span>
<span id="cb1-3"></span>
<span id="cb1-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># API KEY 정보로드</span></span>
<span id="cb1-5">load_dotenv()</span></code></pre></div></div>
</details>
</div>
<div id="24adf030" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># LangSmith 추적을 설정합니다. https://smith.langchain.com</span></span>
<span id="cb2-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># !pip install -qU langchain-teddynote</span></span>
<span id="cb2-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_teddynote <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> logging</span>
<span id="cb2-4"></span>
<span id="cb2-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 프로젝트 이름을 입력합니다.</span></span>
<span id="cb2-6">logging.langsmith(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CH15-Agents"</span>)</span></code></pre></div></div>
</details>
</div>
<p>먼저, 도구(tool) 를 정의합니다.</p>
<div id="dc419bf7" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain.agents <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> tool</span>
<span id="cb3-2"></span>
<span id="cb3-3"></span>
<span id="cb3-4"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@tool</span></span>
<span id="cb3-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> add_function(a: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>, b: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>:</span>
<span id="cb3-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Adds two numbers together."""</span></span>
<span id="cb3-7">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> a <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> b</span></code></pre></div></div>
</details>
</div>
<p>다음으로는 <code>add_function</code> 을 사용하여 덧셈 계산을 수행하는 Agent 를 정의합니다.</p>
<div id="a0abec97" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.prompts <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ChatPromptTemplate, MessagesPlaceholder</span>
<span id="cb4-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_openai <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ChatOpenAI</span>
<span id="cb4-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain.agents <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> create_tool_calling_agent, AgentExecutor</span>
<span id="cb4-4"></span>
<span id="cb4-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 도구 정의</span></span>
<span id="cb4-6">tools <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [add_function]</span>
<span id="cb4-7"></span>
<span id="cb4-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># LLM 생성</span></span>
<span id="cb4-9">gpt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ChatOpenAI(model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gpt-4o-mini"</span>)</span>
<span id="cb4-10"></span>
<span id="cb4-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># prompt 생성</span></span>
<span id="cb4-12">prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ChatPromptTemplate.from_messages(</span>
<span id="cb4-13">    [</span>
<span id="cb4-14">        (</span>
<span id="cb4-15">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"system"</span>,</span>
<span id="cb4-16">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"You are a helpful assistant."</span>,</span>
<span id="cb4-17">        ),</span>
<span id="cb4-18">        (<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"human"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{input}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>),</span>
<span id="cb4-19">        MessagesPlaceholder(variable_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"agent_scratchpad"</span>),</span>
<span id="cb4-20">    ]</span>
<span id="cb4-21">)</span>
<span id="cb4-22"></span>
<span id="cb4-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Agent 생성</span></span>
<span id="cb4-24">gpt_agent <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> create_tool_calling_agent(gpt, tools, prompt)</span>
<span id="cb4-25"></span>
<span id="cb4-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># AgentExecutor 생성</span></span>
<span id="cb4-27">agent_executor <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AgentExecutor(</span>
<span id="cb4-28">    agent<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>gpt_agent,</span>
<span id="cb4-29">    tools<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>tools,</span>
<span id="cb4-30">    verbose<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>,</span>
<span id="cb4-31">    max_iterations<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,</span>
<span id="cb4-32">    handle_parsing_errors<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>,</span>
<span id="cb4-33">)</span></code></pre></div></div>
</details>
</div>
<section id="agentexecutor의-iter" class="level3" data-number="0.1">
<h3 data-number="0.1" class="anchored" data-anchor-id="agentexecutor의-iter"><span class="header-section-number">0.1</span> AgentExecutor의 iter()</h3>
<p>이 메서드는 AgentExecutor의 실행 과정을 단계별로 반복할 수 있게 해주는 반복자(iterator)를 생성합니다.</p>
<p><strong>함수 설명</strong> <code>iter()</code> 는 에이전트가 최종 출력에 도달하기까지 거치는 단계들을 순차적으로 접근할 수 있는 <code>AgentExecutorIterator</code> 객체를 반환합니다.</p>
<p><strong>주요 기능</strong> - <strong>단계별 실행 접근</strong>: 에이전트의 실행 과정을 단계별로 살펴볼 수 있습니다.</p>
<p><strong>흐름 정리</strong></p>
<p><code>"114.5 + 121.2 + 34.2 + 110.1"</code> 의 덧셈 계산을 수행하기 위해서는 단계별로 계산이 수행되게 됩니다.</p>
<ol type="1">
<li>114.5 + 121.2 = 235.7</li>
<li>235.7 + 34.2 = 270.9</li>
<li>270.9 + 110.1 = 381.0</li>
</ol>
<p>이러한 계산 과정을 단계별로 살펴볼 수 있습니다.</p>
<p>이때,</p>
<p>단계별로 계산 결과를 사용자에게 보여주고, 사용자가 계속 진행할지 묻습니다. (<strong>Human-in-the-loop</strong>)</p>
<p>사용자가 ’y’가 아닌 다른 입력을 하면 반복 중단됩니다.</p>
<div id="101628de" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 계산할 질문 설정</span></span>
<span id="cb5-2">question <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"114.5 + 121.2 + 34.2 + 110.1 의 계산 결과는?"</span></span>
<span id="cb5-3"></span>
<span id="cb5-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># agent_executor를 반복적으로 실행</span></span>
<span id="cb5-5"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> step <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> agent_executor.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">iter</span>({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"input"</span>: question}):</span>
<span id="cb5-6">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> output <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:=</span> step.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"intermediate_step"</span>):</span>
<span id="cb5-7">        action, value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> output[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb5-8">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> action.tool <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"add_function"</span>:</span>
<span id="cb5-9">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Tool 실행 결과 출력</span></span>
<span id="cb5-10">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">Tool Name: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>action<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>tool<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">, 실행 결과: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>value<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb5-11">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 사용자에게 계속 진행할지 묻습니다.</span></span>
<span id="cb5-12">        _continue <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">input</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"계속 진행하시겠습니다? (y/n)?:</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">or</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y"</span></span>
<span id="cb5-13">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 사용자가 'y'가 아닌 다른 입력을 하면 반복 중단</span></span>
<span id="cb5-14">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> _continue.lower() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>:</span>
<span id="cb5-15">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">break</span></span>
<span id="cb5-16"></span>
<span id="cb5-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 최종 결과 출력</span></span>
<span id="cb5-18"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"output"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> step:</span>
<span id="cb5-19">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(step[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"output"</span>])</span></code></pre></div></div>
</details>
</div>


</section>

 ]]></description>
  <guid>https://dlwns0719.github.io/my_blog/docs/blog/posts/RAG/15-Agent/05-Iter-Human-In-the-Loop.html</guid>
  <pubDate>Thu, 20 Nov 2025 00:36:30 GMT</pubDate>
</item>
<item>
  <title>LLM 에 도구 바인딩(Binding Tools)</title>
  <link>https://dlwns0719.github.io/my_blog/docs/blog/posts/RAG/15-Agent/02-Bind-Tools.html</link>
  <description><![CDATA[ 






<p>LLM 모델이 도구(tool) 를 호출할 수 있으려면 chat 요청을 할 때 모델에 도구 스키마(tool schema) 를 전달해야 합니다.</p>
<p>도구 호출(tool calling) 기능을 지원하는 LangChain Chat Model 은 <code>.bind_tools()</code> 메서드를 구현하여 LangChain 도구 객체, Pydantic 클래스 또는 JSON 스키마 목록을 수신하고 공급자별 예상 형식으로 채팅 모델에 바인딩(binding) 합니다.</p>
<p>바인딩된 Chat Model 의 후속 호출은 모델 API에 대한 모든 호출에 도구 스키마를 포함합니다.</p>
<div id="d6465534" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># API KEY를 환경변수로 관리하기 위한 설정 파일</span></span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dotenv <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> load_dotenv</span>
<span id="cb1-3"></span>
<span id="cb1-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># API KEY 정보로드</span></span>
<span id="cb1-5">load_dotenv()</span></code></pre></div></div>
</details>
</div>
<div id="2e1d1509" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># LangSmith 추적을 설정합니다. https://smith.langchain.com</span></span>
<span id="cb2-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># !pip install -qU langchain-teddynote</span></span>
<span id="cb2-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_teddynote <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> logging</span>
<span id="cb2-4"></span>
<span id="cb2-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 프로젝트 이름을 입력합니다.</span></span>
<span id="cb2-6">logging.langsmith(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CH15-Bind-Tools"</span>)</span></code></pre></div></div>
</details>
</div>
<section id="llm에-바인딩할-tool-정의" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="llm에-바인딩할-tool-정의"><span class="header-section-number">1</span> LLM에 바인딩할 Tool 정의</h2>
<p>실험을 위한 도구(tool) 를 정의합니다.</p>
<ul>
<li><code>get_word_length</code> : 단어의 길이를 반환하는 함수</li>
<li><code>add_function</code> : 두 숫자를 더하는 함수</li>
<li><code>naver_news_crawl</code> : 네이버 뉴스 기사를 크롤링하여 본문 내용을 반환하는 함수</li>
</ul>
<p><strong>참고</strong> - 도구를 정의할 때 <code>@tool</code> 데코레이터를 사용하여 도구를 정의합니다. - docstring 은 가급적 영어로 작성하는 것을 권장합니다.</p>
<div id="f485e4dc" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> re</span>
<span id="cb3-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> requests</span>
<span id="cb3-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> bs4 <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> BeautifulSoup</span>
<span id="cb3-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain.agents <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> tool</span>
<span id="cb3-5"></span>
<span id="cb3-6"></span>
<span id="cb3-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 도구를 정의합니다.</span></span>
<span id="cb3-8"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@tool</span></span>
<span id="cb3-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> get_word_length(word: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>:</span>
<span id="cb3-10">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Returns the length of a word."""</span></span>
<span id="cb3-11">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(word)</span>
<span id="cb3-12"></span>
<span id="cb3-13"></span>
<span id="cb3-14"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@tool</span></span>
<span id="cb3-15"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> add_function(a: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>, b: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>:</span>
<span id="cb3-16">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Adds two numbers together."""</span></span>
<span id="cb3-17">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> a <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> b</span>
<span id="cb3-18"></span>
<span id="cb3-19"></span>
<span id="cb3-20"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@tool</span></span>
<span id="cb3-21"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> naver_news_crawl(news_url: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>:</span>
<span id="cb3-22">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Crawls a 네이버 (naver.com) news article and returns the body content."""</span></span>
<span id="cb3-23">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># HTTP GET 요청 보내기</span></span>
<span id="cb3-24">    response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> requests.get(news_url)</span>
<span id="cb3-25"></span>
<span id="cb3-26">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 요청이 성공했는지 확인</span></span>
<span id="cb3-27">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> response.status_code <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>:</span>
<span id="cb3-28">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># BeautifulSoup을 사용하여 HTML 파싱</span></span>
<span id="cb3-29">        soup <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> BeautifulSoup(response.text, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"html.parser"</span>)</span>
<span id="cb3-30"></span>
<span id="cb3-31">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 원하는 정보 추출</span></span>
<span id="cb3-32">        title <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> soup.find(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"h2"</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">id</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"title_area"</span>).get_text()</span>
<span id="cb3-33">        content <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> soup.find(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"div"</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">id</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"contents"</span>).get_text()</span>
<span id="cb3-34">        cleaned_title <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> re.sub(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{2,}</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, title)</span>
<span id="cb3-35">        cleaned_content <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> re.sub(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{2,}</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, content)</span>
<span id="cb3-36">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb3-37">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"HTTP 요청 실패. 응답 코드: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>response<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>status_code<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb3-38"></span>
<span id="cb3-39">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>cleaned_title<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>cleaned_content<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb3-40"></span>
<span id="cb3-41"></span>
<span id="cb3-42">tools <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [get_word_length, add_function, naver_news_crawl]</span></code></pre></div></div>
</details>
</div>
</section>
<section id="bind_tools-로-llm-에-도구-바인딩" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="bind_tools-로-llm-에-도구-바인딩"><span class="header-section-number">2</span> bind_tools() 로 LLM 에 도구 바인딩</h2>
<p>llm 모델에 <code>bind_tools()</code> 를 사용하여 도구를 바인딩합니다.</p>
<div id="a4472c5b" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_openai <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ChatOpenAI</span>
<span id="cb4-2"></span>
<span id="cb4-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 모델 생성</span></span>
<span id="cb4-4">llm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ChatOpenAI(model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gpt-4o-mini"</span>, temperature<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb4-5"></span>
<span id="cb4-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 도구 바인딩</span></span>
<span id="cb4-7">llm_with_tools <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> llm.bind_tools(tools)</span></code></pre></div></div>
</details>
</div>
<p>실행결과를 확인합니다.</p>
<p>결과는 <code>tool_calls</code> 에 저장됩니다. 따라서, <code>.tool_calls</code> 를 확인하여 도구 호출 결과를 확인할 수 있습니다.</p>
<p><strong>참고</strong> - <code>name</code> 은 도구의 이름을 의미합니다. - <code>args</code> 는 도구에 전달되는 인자를 의미합니다.</p>
<div id="78d78ef1" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 실행 결과</span></span>
<span id="cb5-2">llm_with_tools.invoke(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"What is the length of the word 'teddynote'?"</span>).tool_calls</span></code></pre></div></div>
</details>
</div>
<p>다음으로는 <code>llm_with_tools</code> 와 <code>JsonOutputToolsParser</code> 를 연결하여 <code>tool_calls</code> 를 parsing 하여 결과를 확인합니다.</p>
<div id="0d47a174" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.output_parsers.openai_tools <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> JsonOutputToolsParser</span>
<span id="cb6-2"></span>
<span id="cb6-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 도구 바인딩 + 도구 파서</span></span>
<span id="cb6-4">chain <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> llm_with_tools <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> JsonOutputToolsParser(tools<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>tools)</span>
<span id="cb6-5"></span>
<span id="cb6-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 실행 결과</span></span>
<span id="cb6-7">tool_call_results <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> chain.invoke(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"What is the length of the word 'teddynote'?"</span>)</span></code></pre></div></div>
</details>
</div>
<div id="fb5ddb5e" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(tool_call_results)</span></code></pre></div></div>
</details>
</div>
<p>실행 결과는 다음과 같습니다.</p>
<p><strong>참고</strong> - <code>type</code>: 도구의 이름 - <code>args</code>: 도구에 전달되는 인자</p>
<div id="fce73aef" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(tool_call_results, end<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">==========</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb8-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 첫 번째 도구 호출 결과</span></span>
<span id="cb8-3">single_result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tool_call_results[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb8-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 도구 이름</span></span>
<span id="cb8-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(single_result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"type"</span>])</span>
<span id="cb8-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 도구 인자</span></span>
<span id="cb8-7"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(single_result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"args"</span>])</span></code></pre></div></div>
</details>
</div>
<p>도구 이름과 일치하는 도구를 찾아 실행합니다.</p>
<div id="b2892283" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1">tool_call_results[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"type"</span>], tools[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].name</span></code></pre></div></div>
</details>
</div>
<p><code>execute_tool_calls</code> 함수는 도구를 찾아 args 를 전달하여 도구를 실행합니다.</p>
<p>즉, <code>type</code> 은 도구의 이름을 의미하고 <code>args</code> 는 도구에 전달되는 인자를 의미합니다.</p>
<div id="2a1ab2f9" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> execute_tool_calls(tool_call_results):</span>
<span id="cb10-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb10-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    도구 호출 결과를 실행하는 함수</span></span>
<span id="cb10-4"></span>
<span id="cb10-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    :param tool_call_results: 도구 호출 결과 리스트</span></span>
<span id="cb10-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    :param tools: 사용 가능한 도구 리스트</span></span>
<span id="cb10-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb10-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 도구 호출 결과 리스트를 순회합니다.</span></span>
<span id="cb10-9">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> tool_call_result <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> tool_call_results:</span>
<span id="cb10-10">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 도구의 이름과 인자를 추출합니다.</span></span>
<span id="cb10-11">        tool_name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tool_call_result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"type"</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 도구의 이름(함수명)</span></span>
<span id="cb10-12">        tool_args <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tool_call_result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"args"</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 도구에 전달되는 인자</span></span>
<span id="cb10-13"></span>
<span id="cb10-14">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 도구 이름과 일치하는 도구를 찾아 실행합니다.</span></span>
<span id="cb10-15">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># next() 함수를 사용하여 일치하는 첫 번째 도구를 찾습니다.</span></span>
<span id="cb10-16">        matching_tool <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">next</span>((tool <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> tool <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> tools <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> tool.name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> tool_name), <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>)</span>
<span id="cb10-17"></span>
<span id="cb10-18">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> matching_tool:</span>
<span id="cb10-19">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 일치하는 도구를 찾았다면 해당 도구를 실행합니다.</span></span>
<span id="cb10-20">            result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> matching_tool.invoke(tool_args)</span>
<span id="cb10-21">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 실행 결과를 출력합니다.</span></span>
<span id="cb10-22">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"[실행도구] </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>tool_name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> [Argument] </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>tool_args<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">[실행결과] </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>result<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb10-23">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb10-24">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 일치하는 도구를 찾지 못했다면 경고 메시지를 출력합니다.</span></span>
<span id="cb10-25">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"경고: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>tool_name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">에 해당하는 도구를 찾을 수 없습니다."</span>)</span>
<span id="cb10-26"></span>
<span id="cb10-27"></span>
<span id="cb10-28"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 도구 호출 실행</span></span>
<span id="cb10-29"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 이전에 얻은 tool_call_results를 인자로 전달하여 함수를 실행합니다.</span></span>
<span id="cb10-30">execute_tool_calls(tool_call_results)</span></code></pre></div></div>
</details>
</div>
</section>
<section id="bind_tools-parser-execution" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="bind_tools-parser-execution"><span class="header-section-number">3</span> bind_tools + Parser + Execution</h2>
<p>이번에는 일련의 과정을 한 번에 실행합니다.</p>
<ul>
<li><code>llm_with_tools</code> : 도구를 바인딩한 모델</li>
<li><code>JsonOutputToolsParser</code> : 도구 호출 결과를 파싱하는 파서</li>
<li><code>execute_tool_calls</code> : 도구 호출 결과를 실행하는 함수</li>
</ul>
<p><strong>흐름 정리</strong> 1. 모델에 도구를 바인딩 2. 도구 호출 결과를 파싱 3. 도구 호출 결과를 실행</p>
<div id="3c6aa1fd" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.output_parsers.openai_tools <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> JsonOutputToolsParser</span>
<span id="cb11-2"></span>
<span id="cb11-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># bind_tools + Parser + Execution</span></span>
<span id="cb11-4">chain <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> llm_with_tools <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> JsonOutputToolsParser(tools<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>tools) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> execute_tool_calls</span></code></pre></div></div>
</details>
</div>
<div id="b1b354a4" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 실행 결과</span></span>
<span id="cb12-2">chain.invoke(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"What is the length of the word 'teddynote'?"</span>)</span></code></pre></div></div>
</details>
</div>
<div id="70a9a955" class="cell" data-execution_count="13">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 실행 결과</span></span>
<span id="cb13-2">chain.invoke(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"114.5 + 121.2"</span>)</span>
<span id="cb13-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">114.5</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">121.2</span>)</span></code></pre></div></div>
</details>
</div>
<div id="2654998d" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 실행 결과</span></span>
<span id="cb14-2">chain.invoke(</span>
<span id="cb14-3">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"뉴스 기사 내용을 크롤링해줘: https://n.news.naver.com/mnews/hotissue/article/092/0002347672?type=series&amp;cid=2000065"</span></span>
<span id="cb14-4">)</span></code></pre></div></div>
</details>
</div>
</section>
<section id="bind_tools-agent-agentexecutor-로-대체" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="bind_tools-agent-agentexecutor-로-대체"><span class="header-section-number">4</span> bind_tools &gt; Agent &amp; AgentExecutor 로 대체</h2>
<p><code>bind_tools()</code> 는 모델에 사용할 수 있는 스키마(도구)를 제공합니다.</p>
<p><code>AgentExecutor</code> 는 실제로 llm 호출, 올바른 도구로 라우팅, 실행, 모델 재호출 등을 위한 실행 루프를 생성합니다.</p>
<p><strong>참고</strong> - <code>Agent</code> 와 <code>AgentExecutor</code> 에 대해서는 다음 장에서 자세히 다룹니다.</p>
<div id="f7449f8f" class="cell" data-execution_count="15">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.prompts <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ChatPromptTemplate, MessagesPlaceholder</span>
<span id="cb15-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_openai <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ChatOpenAI</span>
<span id="cb15-3"></span>
<span id="cb15-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Agent 프롬프트 생성</span></span>
<span id="cb15-5">prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ChatPromptTemplate.from_messages(</span>
<span id="cb15-6">    [</span>
<span id="cb15-7">        (</span>
<span id="cb15-8">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"system"</span>,</span>
<span id="cb15-9">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"You are very powerful assistant, but don't know current events"</span>,</span>
<span id="cb15-10">        ),</span>
<span id="cb15-11">        (<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"user"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{input}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>),</span>
<span id="cb15-12">        MessagesPlaceholder(variable_name<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"agent_scratchpad"</span>),</span>
<span id="cb15-13">    ]</span>
<span id="cb15-14">)</span>
<span id="cb15-15"></span>
<span id="cb15-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 모델 생성</span></span>
<span id="cb15-17">llm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ChatOpenAI(model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gpt-4o-mini"</span>, temperature<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span></code></pre></div></div>
</details>
</div>
<div id="38f30c27" class="cell" data-execution_count="16">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain.agents <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> create_tool_calling_agent</span>
<span id="cb16-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain.agents <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> AgentExecutor</span>
<span id="cb16-3"></span>
<span id="cb16-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 이전에 정의한 도구 사용</span></span>
<span id="cb16-5">tools <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [get_word_length, add_function, naver_news_crawl]</span>
<span id="cb16-6"></span>
<span id="cb16-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Agent 생성</span></span>
<span id="cb16-8">agent <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> create_tool_calling_agent(llm, tools, prompt)</span>
<span id="cb16-9"></span>
<span id="cb16-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># AgentExecutor 생성</span></span>
<span id="cb16-11">agent_executor <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AgentExecutor(</span>
<span id="cb16-12">    agent<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>agent,</span>
<span id="cb16-13">    tools<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>tools,</span>
<span id="cb16-14">    verbose<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>,</span>
<span id="cb16-15">    handle_parsing_errors<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>,</span>
<span id="cb16-16">)</span></code></pre></div></div>
</details>
</div>
<div id="1e3b3b14" class="cell" data-execution_count="17">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Agent 실행</span></span>
<span id="cb17-2">result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> agent_executor.invoke({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"input"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"How many letters in the word `teddynote`?"</span>})</span>
<span id="cb17-3"></span>
<span id="cb17-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 결과 확인</span></span>
<span id="cb17-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"output"</span>])</span></code></pre></div></div>
</details>
</div>
<div id="098ffd53" class="cell" data-execution_count="18">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Agent 실행</span></span>
<span id="cb18-2">result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> agent_executor.invoke({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"input"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"114.5 + 121.2 의 계산 결과는?"</span>})</span>
<span id="cb18-3"></span>
<span id="cb18-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 결과 확인</span></span>
<span id="cb18-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"output"</span>])</span></code></pre></div></div>
</details>
</div>
<p>한 번의 실행으로 끝나는 것이 아닌, 모델이 자신의 결과를 확인하고 다시 자신을 호출하는 과정을 거칩니다.</p>
<div id="6280f9fb" class="cell" data-execution_count="19">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Agent 실행</span></span>
<span id="cb19-2">result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> agent_executor.invoke(</span>
<span id="cb19-3">    {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"input"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"114.5 + 121.2 + 34.2 + 110.1 의 계산 결과는?"</span>}</span>
<span id="cb19-4">)</span>
<span id="cb19-5"></span>
<span id="cb19-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 결과 확인</span></span>
<span id="cb19-7"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"output"</span>])</span>
<span id="cb19-8"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"==========</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb19-9"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">114.5</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">121.2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">34.2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">110.1</span>)</span></code></pre></div></div>
</details>
</div>
<p>이번에는 뉴스 결과를 크롤링 해서 요약 해달라는 요청을 수행합니다.</p>
<div id="5e579cd7" class="cell" data-execution_count="20">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1">result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> agent_executor.invoke(</span>
<span id="cb20-2">    {</span>
<span id="cb20-3">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"input"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"뉴스 기사를 요약해 줘: https://n.news.naver.com/mnews/hotissue/article/092/0002347672?type=series&amp;cid=2000065"</span></span>
<span id="cb20-4">    }</span>
<span id="cb20-5">)</span>
<span id="cb20-6"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"output"</span>])</span></code></pre></div></div>
</details>
</div>


</section>

 ]]></description>
  <guid>https://dlwns0719.github.io/my_blog/docs/blog/posts/RAG/15-Agent/02-Bind-Tools.html</guid>
  <pubDate>Thu, 20 Nov 2025 00:36:30 GMT</pubDate>
</item>
<item>
  <title>도구 호출 에이전트(Tool Calling Agent)</title>
  <link>https://dlwns0719.github.io/my_blog/docs/blog/posts/RAG/15-Agent/03-Agent.html</link>
  <description><![CDATA[ 






<p>도구 호출을 사용하면 모델이 하나 이상의 <strong>도구(tool)</strong> 가 <strong>호출되어야 하는 시기를 감지하고 해당 도구에 전달해야 하는 입력</strong> 으로 전달할 수 있습니다.</p>
<p>API 호출에서 도구를 설명하고 모델이 이러한 도구를 호출하기 위한 인수가 포함된 JSON과 같은 구조화된 객체를 출력하도록 지능적으로 선택할 수 있습니다.</p>
<p>도구 API 의 목표는 일반 텍스트 완성이나 채팅 API를 사용하여 수행할 수 있는 것보다 더 안정적으로 유효하고 유용한 <strong>도구 호출(tool call)</strong> 을 반환하는 것입니다.</p>
<p>이러한 구조화된 출력을 도구 호출 채팅 모델에 여러 도구를 바인딩하고 모델이 호출할 도구를 선택할 수 있다는 사실과 결합하여 쿼리가 해결될 때까지 반복적으로 도구를 호출하고 결과를 수신하는 에이전트를 만들 수 있습니다.</p>
<p>이것은 OpenAI 의 특정 도구 호출 스타일에 맞게 설계된 OpenAI 도구 에이전트의 보다 <strong>일반화된 버전</strong> 입니다.</p>
<p>이 에이전트는 LangChain의 ToolCall 인터페이스를 사용하여 OpenAI 외에도 <code>Anthropic</code>, <code>Google Gemini</code>, <code>Mistral</code>과 같은 더 광범위한 공급자 구현을 지원합니다.</p>
<p><strong>참고 링크</strong></p>
<ul>
<li><a href="https://python.langchain.com/v0.1/docs/modules/agents/agent_types/tool_calling/">LangChain 공식 도큐먼트</a></li>
</ul>
<p><img src="https://dlwns0719.github.io/my_blog/docs/blog/posts/RAG/15-Agent/assets/agent-concept.png" class="img-fluid"></p>
<div id="a7c58715" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># API 키를 환경변수로 관리하기 위한 설정 파일</span></span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> dotenv <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> load_dotenv</span>
<span id="cb1-3"></span>
<span id="cb1-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># API 키 정보 로드</span></span>
<span id="cb1-5">load_dotenv()</span></code></pre></div></div>
</details>
</div>
<div id="6e56c40a" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># LangSmith 추적을 설정합니다. https://smith.langchain.com</span></span>
<span id="cb2-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># !pip install -qU langchain-teddynote</span></span>
<span id="cb2-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_teddynote <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> logging</span>
<span id="cb2-4"></span>
<span id="cb2-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 프로젝트 이름을 입력합니다.</span></span>
<span id="cb2-6">logging.langsmith(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CH15-Agents"</span>)</span></code></pre></div></div>
</details>
</div>
<div id="2047d1e0" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain.tools <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> tool</span>
<span id="cb3-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> typing <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> List, Dict, Annotated</span>
<span id="cb3-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_teddynote.tools <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> GoogleNews</span>
<span id="cb3-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_experimental.utilities <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> PythonREPL</span>
<span id="cb3-5"></span>
<span id="cb3-6"></span>
<span id="cb3-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 도구 생성</span></span>
<span id="cb3-8"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@tool</span></span>
<span id="cb3-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> search_news(query: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> List[Dict[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>]]:</span>
<span id="cb3-10">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Search Google News by input keyword"""</span></span>
<span id="cb3-11">    news_tool <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> GoogleNews()</span>
<span id="cb3-12">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> news_tool.search_by_keyword(query, k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb3-13"></span>
<span id="cb3-14"></span>
<span id="cb3-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 도구 생성</span></span>
<span id="cb3-16"><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">@tool</span></span>
<span id="cb3-17"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> python_repl_tool(</span>
<span id="cb3-18">    code: Annotated[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"The python code to execute to generate your chart."</span>],</span>
<span id="cb3-19">):</span>
<span id="cb3-20">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Use this to execute python code. If you want to see the output of a value,</span></span>
<span id="cb3-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    you should print it out with `print(...)`. This is visible to the user."""</span></span>
<span id="cb3-22">    result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span></span>
<span id="cb3-23">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">try</span>:</span>
<span id="cb3-24">        result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> PythonREPL().run(code)</span>
<span id="cb3-25">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">except</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">BaseException</span> <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> e:</span>
<span id="cb3-26">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Failed to execute. Error: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">repr</span>(e)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb3-27">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">finally</span>:</span>
<span id="cb3-28">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> result</span>
<span id="cb3-29"></span>
<span id="cb3-30"></span>
<span id="cb3-31"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"도구 이름: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>search_news<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb3-32"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"도구 설명: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>search_news<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>description<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb3-33"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"도구 이름: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>python_repl_tool<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb3-34"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"도구 설명: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>python_repl_tool<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>description<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div></div>
</details>
</div>
<div id="ee789017" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># tools 정의</span></span>
<span id="cb4-2">tools <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [search_news, python_repl_tool]</span></code></pre></div></div>
</details>
</div>
<section id="agent-프롬프트-생성" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="agent-프롬프트-생성"><span class="header-section-number">1</span> Agent 프롬프트 생성</h2>
<ul>
<li><code>chat_history</code> : 이전 대화 내용을 저장하는 변수 (멀티턴을 지원하지 않는다면, 생략 가능합니다.)</li>
<li><code>agent_scratchpad</code> : 에이전트가 임시로 저장하는 변수</li>
<li><code>input</code> : 사용자의 입력</li>
</ul>
<div id="b9ab9d67" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.prompts <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ChatPromptTemplate</span>
<span id="cb5-2"></span>
<span id="cb5-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 프롬프트 생성</span></span>
<span id="cb5-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 프롬프트는 에이전트에게 모델이 수행할 작업을 설명하는 텍스트를 제공합니다. (도구의 이름과 역할을 입력)</span></span>
<span id="cb5-5">prompt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ChatPromptTemplate.from_messages(</span>
<span id="cb5-6">    [</span>
<span id="cb5-7">        (</span>
<span id="cb5-8">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"system"</span>,</span>
<span id="cb5-9">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"You are a helpful assistant. "</span></span>
<span id="cb5-10">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Make sure to use the `search_news` tool for searching keyword related news."</span>,</span>
<span id="cb5-11">        ),</span>
<span id="cb5-12">        (<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"placeholder"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{chat_history}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>),</span>
<span id="cb5-13">        (<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"human"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{input}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>),</span>
<span id="cb5-14">        (<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"placeholder"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{agent_scratchpad}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>),</span>
<span id="cb5-15">    ]</span>
<span id="cb5-16">)</span></code></pre></div></div>
</details>
</div>
</section>
<section id="agent-생성" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="agent-생성"><span class="header-section-number">2</span> Agent 생성</h2>
<div id="b26ef43d" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_openai <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ChatOpenAI</span>
<span id="cb6-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain.agents <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> create_tool_calling_agent</span>
<span id="cb6-3"></span>
<span id="cb6-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># LLM 정의</span></span>
<span id="cb6-5">llm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ChatOpenAI(model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gpt-4o-mini"</span>, temperature<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb6-6"></span>
<span id="cb6-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Agent 생성</span></span>
<span id="cb6-8">agent <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> create_tool_calling_agent(llm, tools, prompt)</span></code></pre></div></div>
</details>
</div>
</section>
<section id="agentexecutor" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="agentexecutor"><span class="header-section-number">3</span> AgentExecutor</h2>
<p>AgentExecutor는 도구를 사용하는 에이전트를 실행하는 클래스입니다.</p>
<p><strong>주요 속성</strong> - <code>agent</code>: 실행 루프의 각 단계에서 계획을 생성하고 행동을 결정하는 에이전트 - <code>tools</code>: 에이전트가 사용할 수 있는 유효한 도구 목록 - <code>return_intermediate_steps</code>: 최종 출력과 함께 에이전트의 중간 단계 경로를 반환할지 여부 - <code>max_iterations</code>: 실행 루프를 종료하기 전 최대 단계 수 - <code>max_execution_time</code>: 실행 루프에 소요될 수 있는 최대 시간 - <code>early_stopping_method</code>: 에이전트가 <code>AgentFinish</code>를 반환하지 않을 때 사용할 조기 종료 방법. (“force” or “generate”) - <code>"force"</code> 는 시간 또는 반복 제한에 도달하여 중지되었다는 문자열을 반환합니다. - <code>"generate"</code> 는 에이전트의 LLM 체인을 마지막으로 한 번 호출하여 이전 단계에 따라 최종 답변을 생성합니다. - <code>handle_parsing_errors</code>: 에이전트의 출력 파서에서 발생한 오류 처리 방법. (True, False, 또는 오류 처리 함수) - <code>trim_intermediate_steps</code>: 중간 단계를 트리밍하는 방법. (-1 trim 하지 않음, 또는 트리밍 함수)</p>
<p><strong>주요 메서드</strong> 1. <code>invoke</code>: 에이전트 실행 2. <code>stream</code>: 최종 출력에 도달하는 데 필요한 단계를 스트리밍</p>
<p><strong>주요 기능</strong> 1. <strong>도구 검증</strong>: 에이전트와 호환되는 도구인지 확인 2. <strong>실행 제어</strong>: 최대 반복 횟수 및 실행 시간 제한 설정 가능 3. <strong>오류 처리</strong>: 출력 파싱 오류에 대한 다양한 처리 옵션 제공 4. <strong>중간 단계 관리</strong>: 중간 단계 트리밍 및 반환 옵션 5. <strong>비동기 지원</strong>: 비동기 실행 및 스트리밍 지원</p>
<p><strong>최적화 팁</strong> - <code>max_iterations</code>와 <code>max_execution_time</code>을 적절히 설정하여 실행 시간 관리 - <code>trim_intermediate_steps</code>를 활용하여 메모리 사용량 최적화 - 복잡한 작업의 경우 <code>stream</code> 메서드를 사용하여 단계별 결과 모니터링</p>
<div id="c14d2a84" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain.agents <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> AgentExecutor</span>
<span id="cb7-2"></span>
<span id="cb7-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># AgentExecutor 생성</span></span>
<span id="cb7-4">agent_executor <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AgentExecutor(</span>
<span id="cb7-5">    agent<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>agent,</span>
<span id="cb7-6">    tools<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>tools,</span>
<span id="cb7-7">    verbose<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>,</span>
<span id="cb7-8">    max_iterations<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,</span>
<span id="cb7-9">    max_execution_time<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,</span>
<span id="cb7-10">    handle_parsing_errors<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>,</span>
<span id="cb7-11">)</span>
<span id="cb7-12"></span>
<span id="cb7-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># AgentExecutor 실행</span></span>
<span id="cb7-14">result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> agent_executor.invoke({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"input"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AI 투자와 관련된 뉴스를 검색해 주세요."</span>})</span>
<span id="cb7-15"></span>
<span id="cb7-16"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Agent 실행 결과:"</span>)</span>
<span id="cb7-17"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(result[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"output"</span>])</span></code></pre></div></div>
</details>
</div>
</section>
<section id="stream-출력으로-단계별-결과-확인" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="stream-출력으로-단계별-결과-확인"><span class="header-section-number">4</span> Stream 출력으로 단계별 결과 확인</h2>
<p>AgentExecutor의 <code>stream()</code> 메소드를 사용하여 에이전트의 중간 단계를 스트리밍할 것입니다.</p>
<p><code>stream()</code>의 출력은 (Action, Observation) 쌍 사이에서 번갈아 나타나며, 최종적으로 에이전트가 목표를 달성했다면 답변으로 마무리됩니다.</p>
<p>다음과 같은 형태로 보일 것입니다.</p>
<ol type="1">
<li>Action 출력</li>
<li>Observation 출력</li>
<li>Action 출력</li>
<li>Observation 출력</li>
</ol>
<p>… (목표 달성까지 계속) …</p>
<p>그 다음, 최종 목표가 달성되면 에이전트는 최종 답변을 출력할 것입니다.</p>
<p>이러한 출력의 내용은 다음과 같이 요약됩니다.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 44%">
<col style="width: 55%">
</colgroup>
<thead>
<tr class="header">
<th>출력</th>
<th>내용</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Action</td>
<td><code>actions</code>: AgentAction 또는 그 하위 클래스<br><code>messages</code>: 액션 호출에 해당하는 채팅 메시지</td>
</tr>
<tr class="even">
<td>Observation</td>
<td><code>steps</code>: 현재 액션과 그 관찰을 포함한 에이전트가 지금까지 수행한 작업의 기록<br><code>messages</code>: 함수 호출 결과(즉, 관찰)를 포함한 채팅 메시지</td>
</tr>
<tr class="odd">
<td>Final Answer</td>
<td><code>output</code>: AgentFinish<br><code>messages</code>: 최종 출력을 포함한 채팅 메시지</td>
</tr>
</tbody>
</table>
<pre><code>
::: {#bf7b4031 .cell execution_count=8}
``` {.python .cell-code}
from langchain.agents import AgentExecutor

# AgentExecutor 생성
agent_executor = AgentExecutor(
    agent=agent,
    tools=tools,
    verbose=False,
    handle_parsing_errors=True,
)</code></pre>
<p>:::</p>
<div id="642b7a0f" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 스트리밍 모드로 실행합니다</span></span>
<span id="cb9-2">result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> agent_executor.stream({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"input"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AI 투자와 관련된 뉴스를 검색해 주세요."</span>})</span>
<span id="cb9-3"></span>
<span id="cb9-4"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> step <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> result:</span>
<span id="cb9-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 중간 단계 출력</span></span>
<span id="cb9-6">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(step)</span>
<span id="cb9-7">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"==="</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>)</span></code></pre></div></div>
</details>
</div>
<section id="중간-단계-출력을-사용자-정의-함수로-출력" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="중간-단계-출력을-사용자-정의-함수로-출력"><span class="header-section-number">4.1</span> 중간 단계 출력을 사용자 정의 함수로 출력</h3>
<p>다음의 3개 함수를 정의하고 이를 통해 중간 단계 출력을 사용자 정의합니다.</p>
<ul>
<li><code>tool_callback</code>: 도구 호출 출력을 처리하는 함수</li>
<li><code>observation_callback</code>: 관찰(Observation) 출력을 처리하는 함수</li>
<li><code>result_callback</code>: 최종 답변 출력을 처리하는 함수</li>
</ul>
<div id="90683519" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 업데이트</span></span>
<span id="cb10-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># !pip install -U langchain-teddynote</span></span></code></pre></div></div>
</details>
</div>
<p>아래는 Agent 의 중간 단계 과정을 깔끔하게 출력하기 위하여 사용되는 콜백 함수입니다.</p>
<p>이 콜백 함수는 Streamlit 에서 중간 단계를 출력하여 사용자에게 제공할 때 유용할 수 있습니다.</p>
<div id="16505aa1" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_teddynote.messages <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> AgentStreamParser</span>
<span id="cb11-2"></span>
<span id="cb11-3">agent_stream_parser <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AgentStreamParser()</span></code></pre></div></div>
</details>
</div>
<p>스트리밍 방식으로 Agent 의 응답 과정을 확인합니다.</p>
<div id="a23a18cc" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 질의에 대한 답변을 스트리밍으로 출력 요청</span></span>
<span id="cb12-2">result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> agent_executor.stream(</span>
<span id="cb12-3">    {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"input"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"matplotlib 을 사용하여 pie 차트를 그리는 코드를 작성하고 실행하세요."</span>}</span>
<span id="cb12-4">)</span>
<span id="cb12-5"></span>
<span id="cb12-6"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> step <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> result:</span>
<span id="cb12-7">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 중간 단계를 parser 를 사용하여 단계별로 출력</span></span>
<span id="cb12-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># print(step)</span></span>
<span id="cb12-9">    agent_stream_parser.process_agent_steps(step)</span></code></pre></div></div>
</details>
</div>
<p>다음은 callback 을 수정하여 사용하는 방법입니다.</p>
<div id="d52ccb95" class="cell" data-execution_count="13">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># AgentCallbacks와 AgentStreamParser를 langchain_teddynote.messages에서 가져옵니다.</span></span>
<span id="cb13-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_teddynote.messages <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> AgentCallbacks, AgentStreamParser</span>
<span id="cb13-3"></span>
<span id="cb13-4"></span>
<span id="cb13-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 도구 호출 시 실행되는 콜백 함수입니다.</span></span>
<span id="cb13-6"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> tool_callback(tool) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>:</span>
<span id="cb13-7">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;&lt;&lt;&lt;&lt;&lt;&lt; 도구 호출 &gt;&gt;&gt;&gt;&gt;&gt;"</span>)</span>
<span id="cb13-8">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Tool: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>tool<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'tool'</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 사용된 도구의 이름을 출력합니다.</span></span>
<span id="cb13-9">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;&lt;&lt;&lt;&lt;&lt;&lt; 도구 호출 &gt;&gt;&gt;&gt;&gt;&gt;"</span>)</span>
<span id="cb13-10"></span>
<span id="cb13-11"></span>
<span id="cb13-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 관찰 결과를 출력하는 콜백 함수입니다.</span></span>
<span id="cb13-13"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> observation_callback(observation) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>:</span>
<span id="cb13-14">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;&lt;&lt;&lt;&lt;&lt;&lt; 관찰 내용 &gt;&gt;&gt;&gt;&gt;&gt;"</span>)</span>
<span id="cb13-15">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(</span>
<span id="cb13-16">        <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Observation: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>observation<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'observation'</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb13-17">    )  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 관찰 내용을 출력합니다.</span></span>
<span id="cb13-18">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;&lt;&lt;&lt;&lt;&lt;&lt; 관찰 내용 &gt;&gt;&gt;&gt;&gt;&gt;"</span>)</span>
<span id="cb13-19"></span>
<span id="cb13-20"></span>
<span id="cb13-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 최종 결과를 출력하는 콜백 함수입니다.</span></span>
<span id="cb13-22"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> result_callback(result: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>:</span>
<span id="cb13-23">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;&lt;&lt;&lt;&lt;&lt;&lt; 최종 답변 &gt;&gt;&gt;&gt;&gt;&gt;"</span>)</span>
<span id="cb13-24">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(result)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 최종 답변을 출력합니다.</span></span>
<span id="cb13-25">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;&lt;&lt;&lt;&lt;&lt;&lt; 최종 답변 &gt;&gt;&gt;&gt;&gt;&gt;"</span>)</span>
<span id="cb13-26"></span>
<span id="cb13-27"></span>
<span id="cb13-28"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># AgentCallbacks 객체를 생성하여 각 단계별 콜백 함수를 설정합니다.</span></span>
<span id="cb13-29">agent_callbacks <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AgentCallbacks(</span>
<span id="cb13-30">    tool_callback<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>tool_callback,</span>
<span id="cb13-31">    observation_callback<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>observation_callback,</span>
<span id="cb13-32">    result_callback<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>result_callback,</span>
<span id="cb13-33">)</span>
<span id="cb13-34"></span>
<span id="cb13-35"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># AgentStreamParser 객체를 생성하여 에이전트의 실행 과정을 파싱합니다.</span></span>
<span id="cb13-36">agent_stream_parser <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AgentStreamParser(agent_callbacks)</span></code></pre></div></div>
</details>
</div>
<p>아래의 출력 내용을 확인해 보면 중간 내용의 출력 값이 내가 변경한 콜백 함수의 출력 값으로 변경된 것을 확인할 수 있습니다.</p>
<div id="9bc6f347" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 질의에 대한 답변을 스트리밍으로 출력 요청</span></span>
<span id="cb14-2">result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> agent_executor.stream({<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"input"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"AI 투자관련 뉴스를 검색해 주세요."</span>})</span>
<span id="cb14-3"></span>
<span id="cb14-4"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> step <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> result:</span>
<span id="cb14-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 중간 단계를 parser 를 사용하여 단계별로 출력</span></span>
<span id="cb14-6">    agent_stream_parser.process_agent_steps(step)</span></code></pre></div></div>
</details>
</div>
</section>
</section>
<section id="이전-대화내용-기억하는-agent" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="이전-대화내용-기억하는-agent"><span class="header-section-number">5</span> 이전 대화내용 기억하는 Agent</h2>
<p>이전의 대화내용을 기억하기 위해서는 <code>RunnableWithMessageHistory</code> 를 사용하여 <code>AgentExecutor</code> 를 감싸줍니다.</p>
<p><code>RunnableWithMessageHistory</code> 에 대한 자세한 내용은 아래 링크를 참고해 주세요.</p>
<p><strong>참고</strong> - <a href="https://wikidocs.net/254682">RunnableWithMessageHistory</a></p>
<div id="b306df6b" class="cell" data-execution_count="15">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_community.chat_message_histories <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> ChatMessageHistory</span>
<span id="cb15-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> langchain_core.runnables.history <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> RunnableWithMessageHistory</span>
<span id="cb15-3"></span>
<span id="cb15-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># session_id 를 저장할 딕셔너리 생성</span></span>
<span id="cb15-5">store <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {}</span>
<span id="cb15-6"></span>
<span id="cb15-7"></span>
<span id="cb15-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># session_id 를 기반으로 세션 기록을 가져오는 함수</span></span>
<span id="cb15-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> get_session_history(session_ids):</span>
<span id="cb15-10">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> session_ids <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> store:  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># session_id 가 store에 없는 경우</span></span>
<span id="cb15-11">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 새로운 ChatMessageHistory 객체를 생성하여 store에 저장</span></span>
<span id="cb15-12">        store[session_ids] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ChatMessageHistory()</span>
<span id="cb15-13">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> store[session_ids]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 해당 세션 ID에 대한 세션 기록 반환</span></span>
<span id="cb15-14"></span>
<span id="cb15-15"></span>
<span id="cb15-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 채팅 메시지 기록이 추가된 에이전트를 생성합니다.</span></span>
<span id="cb15-17">agent_with_chat_history <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> RunnableWithMessageHistory(</span>
<span id="cb15-18">    agent_executor,</span>
<span id="cb15-19">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 대화 session_id</span></span>
<span id="cb15-20">    get_session_history,</span>
<span id="cb15-21">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 프롬프트의 질문이 입력되는 key: "input"</span></span>
<span id="cb15-22">    input_messages_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"input"</span>,</span>
<span id="cb15-23">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 프롬프트의 메시지가 입력되는 key: "chat_history"</span></span>
<span id="cb15-24">    history_messages_key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"chat_history"</span>,</span>
<span id="cb15-25">)</span></code></pre></div></div>
</details>
</div>
<div id="300db801" class="cell" data-execution_count="16">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 질의에 대한 답변을 스트리밍으로 출력 요청</span></span>
<span id="cb16-2">response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> agent_with_chat_history.stream(</span>
<span id="cb16-3">    {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"input"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"안녕? 내 이름은 테디야!"</span>},</span>
<span id="cb16-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># session_id 설정</span></span>
<span id="cb16-5">    config<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"configurable"</span>: {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"session_id"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"abc123"</span>}},</span>
<span id="cb16-6">)</span>
<span id="cb16-7"></span>
<span id="cb16-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 출력 확인</span></span>
<span id="cb16-9"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> step <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> response:</span>
<span id="cb16-10">    agent_stream_parser.process_agent_steps(step)</span></code></pre></div></div>
</details>
</div>
<div id="f6f55bd5" class="cell" data-execution_count="17">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 질의에 대한 답변을 스트리밍으로 출력 요청</span></span>
<span id="cb17-2">response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> agent_with_chat_history.stream(</span>
<span id="cb17-3">    {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"input"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"내 이름이 뭐라고?"</span>},</span>
<span id="cb17-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># session_id 설정</span></span>
<span id="cb17-5">    config<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"configurable"</span>: {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"session_id"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"abc123"</span>}},</span>
<span id="cb17-6">)</span>
<span id="cb17-7"></span>
<span id="cb17-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 출력 확인</span></span>
<span id="cb17-9"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> step <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> response:</span>
<span id="cb17-10">    agent_stream_parser.process_agent_steps(step)</span></code></pre></div></div>
</details>
</div>
<div id="e73e5e75" class="cell" data-execution_count="18">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 질의에 대한 답변을 스트리밍으로 출력 요청</span></span>
<span id="cb18-2">response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> agent_with_chat_history.stream(</span>
<span id="cb18-3">    {</span>
<span id="cb18-4">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"input"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"내 이메일 주소는 teddy@teddynote.com 이야. 회사 이름은 테디노트 주식회사야."</span></span>
<span id="cb18-5">    },</span>
<span id="cb18-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># session_id 설정</span></span>
<span id="cb18-7">    config<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"configurable"</span>: {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"session_id"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"abc123"</span>}},</span>
<span id="cb18-8">)</span>
<span id="cb18-9"></span>
<span id="cb18-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 출력 확인</span></span>
<span id="cb18-11"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> step <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> response:</span>
<span id="cb18-12">    agent_stream_parser.process_agent_steps(step)</span></code></pre></div></div>
</details>
</div>
<div id="cdf4fde2" class="cell" data-execution_count="19">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 질의에 대한 답변을 스트리밍으로 출력 요청</span></span>
<span id="cb19-2">response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> agent_with_chat_history.stream(</span>
<span id="cb19-3">    {</span>
<span id="cb19-4">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"input"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"최신 뉴스 5개를 검색해서 이메일의 본문으로 작성해줘. "</span></span>
<span id="cb19-5">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"수신인에는 `셜리 상무님` 그리고, 발신인에는 내 인적정보를 적어줘."</span></span>
<span id="cb19-6">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"정중한 어조로 작성하고, 메일의 시작과 끝에는 적절한 인사말과 맺음말을 적어줘."</span></span>
<span id="cb19-7">    },</span>
<span id="cb19-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># session_id 설정</span></span>
<span id="cb19-9">    config<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"configurable"</span>: {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"session_id"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"abc123"</span>}},</span>
<span id="cb19-10">)</span>
<span id="cb19-11"></span>
<span id="cb19-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 출력 확인</span></span>
<span id="cb19-13"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> step <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> response:</span>
<span id="cb19-14">    agent_stream_parser.process_agent_steps(step)</span></code></pre></div></div>
</details>
</div>
<div id="4417861b" class="cell" data-execution_count="20">
<details class="code-fold">
<summary>코드</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 질의에 대한 답변을 스트리밍으로 출력 요청</span></span>
<span id="cb20-2">response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> agent_with_chat_history.stream(</span>
<span id="cb20-3">    {</span>
<span id="cb20-4">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"input"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"내 이름이 뭐야?"</span></span>
<span id="cb20-5">    },</span>
<span id="cb20-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># session_id 설정</span></span>
<span id="cb20-7">    config<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>{<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"configurable"</span>: {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"session_id"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"def456"</span>}},</span>
<span id="cb20-8">)</span>
<span id="cb20-9"></span>
<span id="cb20-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 출력 확인</span></span>
<span id="cb20-11"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> step <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> response:</span>
<span id="cb20-12">    agent_stream_parser.process_agent_steps(step)</span></code></pre></div></div>
</details>
</div>


</section>

 ]]></description>
  <guid>https://dlwns0719.github.io/my_blog/docs/blog/posts/RAG/15-Agent/03-Agent.html</guid>
  <pubDate>Thu, 20 Nov 2025 00:36:30 GMT</pubDate>
</item>
</channel>
</rss>
